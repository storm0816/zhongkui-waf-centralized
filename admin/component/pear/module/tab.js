layui.define(["jquery","element"],function(t){"use strict";var a,e=layui.jquery,i=layui.element,l=function(t){this.option=t},s=new Array,n=0;l.prototype.render=function(t){var r,o={elem:t.elem,data:t.data,tool:t.tool,roll:t.roll,index:t.index,width:t.width,height:t.height,tabMax:t.tabMax,session:!!t.session&&t.session,preload:!!t.preload&&t.preload,closeEvent:t.closeEvent,success:t.success?t.success:function(t){}};o.session&&(null!=sessionStorage.getItem(o.elem+"-pear-tab-data")?(s=JSON.parse(sessionStorage.getItem(o.elem+"-pear-tab-data")),o.data=JSON.parse(sessionStorage.getItem(o.elem+"-pear-tab-data")),n=sessionStorage.getItem(o.elem+"-pear-tab-data-current"),s.forEach(function(t,a){t.id==n&&(o.index=a)})):s=t.data);var u=function(t){var a="",i=t.type+" ";1==t.roll&&(a="layui-tab-roll");0!=t.tool&&(a="layui-tab-tool");1==t.roll&&0!=t.tool&&(a="layui-tab-rollTool");var l='<div class="pear-tab '+i+a+' layui-tab" lay-filter="'+t.elem+'" lay-allowClose="true">',s='<ul class="layui-tab-title">',n='<div class="layui-tab-content">',r=0;return e.each(t.data,function(a,e){var i="";t.index==r?i+='<li lay-id="'+e.id+'" class="layui-this"><span class="pear-tab-active"></span>':i+='<li lay-id="'+e.id+'" ><span class="pear-tab-active"></span>',e.close?i+='<span class="able-close title">'+e.title+"</span>":i+='<span class="disable-close title">'+e.title+"</span>",s+=i+='<i class="layui-icon layui-unselect layui-tab-close">ဆ</i></li>',t.index==r?n+='<div class="layui-show layui-tab-item"><iframe id="'+e.id+'" data-frameid="'+e.id+'"  src="'+e.url+'" frameborder="no" border="0" marginwidth="0" marginheight="0" style="width: 100%;height: 100%;" allowfullscreen="true"></iframe></div>':(t.preload||(e.url="about:blank"),n+='<div class="layui-tab-item"><iframe id="'+e.id+'" data-frameid="'+e.id+'"  src="'+e.url+'" frameborder="no" border="0" marginwidth="0" marginheight="0" style="width: 100%;height: 100%;" allowfullscreen="true"></iframe></div>'),r++}),'<dd id="closeThis"><a href="#">关 闭 当 前</a></dd>','<dd id="closeOther"><a href="#">关 闭 其 他</a></dd>','<dd id="closeAll"><a href="#">关 闭 全 部</a></dd>',"</dl></li></ul></li></div>",l+=s+="</ul>",l+='<div class="layui-tab-control"><li class="layui-tab-prev layui-icon layui-icon-left"></li><li class="layui-tab-next layui-icon layui-icon-right"></li><li class="layui-tab-tool layui-icon layui-icon-down"><ul class="layui-nav" lay-filter=""><li class="layui-nav-item"><a href="javascript:;"></a><dl class="layui-nav-child"><dd id="closeThis"><a href="#">关 闭 当 前</a></dd><dd id="closeOther"><a href="#">关 闭 其 他</a></dd><dd id="closeAll"><a href="#">关 闭 全 部</a></dd></dl></li></ul></li></div>',l+=n+="</div>",l+="</div>",l+=""}(o);return e("#"+o.elem).html(u),e(".layui-tab[lay-filter='"+o.elem+"'] .layui-tab-prev").click(function(){d("left",o)}),e(".layui-tab[lay-filter='"+o.elem+"'] .layui-tab-next").click(function(){d("right",o)}),i.init(),function(t){e("body .layui-tab[lay-filter='"+t.elem+"']").on("click","#closeThis",function(){var a=e(".layui-tab[lay-filter='"+t.elem+"'] .layui-tab-title .layui-this");if(a.find("span").is(".able-close")){var i=a.attr("lay-id");c(t.elem,i,t.closeEvent,t)}else layer.msg("当前页面不允许关闭",{icon:3,time:800})}),e("body .layui-tab[lay-filter='"+t.elem+"']").on("click","#closeOther",function(){var a=e(".layui-tab[lay-filter='"+t.elem+"'] .layui-tab-title .layui-this").attr("lay-id"),i=e(".layui-tab[lay-filter='"+t.elem+"'] .layui-tab-title li");e.each(i,function(i){e(this).attr("lay-id")!=a&&e(this).find("span").is(".able-close")&&c(t.elem,e(this).attr("lay-id"),t.closeEvent,t)})}),e("body .layui-tab[lay-filter='"+t.elem+"']").on("click","#closeAll",function(){e(".layui-tab[lay-filter='"+t.elem+"'] .layui-tab-title .layui-this").attr("lay-id");var a=e(".layui-tab[lay-filter='"+t.elem+"'] .layui-tab-title li");e.each(a,function(a){e(this).find("span").is(".able-close")&&c(t.elem,e(this).attr("lay-id"),t.closeEvent,t)})})}(o),e("#"+o.elem).width(t.width),e("#"+o.elem).height(t.height),e("#"+o.elem).css({position:"relative"}),function(t){e(".layui-tab[lay-filter='"+t.elem+"']").on("click",".layui-tab-close",function(){var a=e(this).parent().attr("lay-id");c(t.elem,a,t.closeEvent,t)})}(o),o.success(sessionStorage.getItem(o.elem+"-pear-tab-data-current")),e("body .layui-tab[lay-filter='"+o.elem+"'] .layui-tab-title").on("contextmenu","li",function(t){var i=t.clientY,l=t.clientX,s=(e(this).attr("lay-id"),"<ul><li class='item' id='"+o.elem+"closeThis'>关闭当前</li><li class='item' id='"+o.elem+"closeOther'>关闭其他</li><li class='item' id='"+o.elem+"closeAll'>关闭所有</li></ul>");return a=e(this),l+100>e(window).width()&&(l=e(window).width()-100),layer.open({type:1,title:!1,shade:!1,skin:"pear-tab-menu",closeBtn:!1,area:["100px","108px"],fixed:!0,anim:!1,isOutAnim:!1,offset:[i,l],content:s,success:function(t,i){var l;layer.close(r),r=i,function(t,i){e("#"+t.elem+"closeThis").click(function(){var e=a;if(e.find("span").is(".able-close")){var l=e.attr("lay-id");c(t.elem,l,t.closeEvent,t)}else layer.msg("当前页面不允许关闭",{icon:3,time:800});layer.close(i)}),e("#"+t.elem+"closeOther").click(function(){var l=a.attr("lay-id"),s=e(".layui-tab[lay-filter='"+t.elem+"'] .layui-tab-title li");e.each(s,function(a){e(this).attr("lay-id")!=l&&e(this).find("span").is(".able-close")&&c(t.elem,e(this).attr("lay-id"),t.closeEvent,t)}),layer.close(i)}),e("#"+t.elem+"closeAll").click(function(){a.attr("lay-id");var l=e(".layui-tab[lay-filter='"+t.elem+"'] .layui-tab-title li");e.each(l,function(a){e(this).find("span").is(".able-close")&&c(t.elem,e(this).attr("lay-id"),t.closeEvent,t)}),layer.close(i)})}(o,i),e(t).on("mouseout",function(){l=setTimeout(function(){layer.close(i)},30)}),e(t).on("mouseover",function(){clearTimeout(l)}),e(t).on("contextmenu",function(){return!1})}}),!1}),function(t){var a=e("body .layui-tab[lay-filter='"+t.elem+"'] .layui-tab-title"),i=e("#"+t.elem+"  .layui-tab-title");a.on("mousewheel DOMMouseScroll",function(t){t.originalEvent.preventDefault();var a=t.originalEvent.wheelDelta&&(t.originalEvent.wheelDelta>0?"top":"down")||t.originalEvent.detail&&(t.originalEvent.detail>0?"down":"top"),e=i.scrollLeft();"top"===a?e-=100:"down"===a&&(e+=100),i.scrollLeft(e)});var l=0;a.on("touchstart",function(t){var a=t.originalEvent.targetTouches[0];l=a.pageX}),a.on("touchmove",function(t){var a=t.originalEvent;if(!(a.targetTouches.length>1)){a.preventDefault();var e=a.targetTouches[0],s=l-e.pageX,n=i.scrollLeft();l=e.pageX,i.scrollLeft(n+=s)}})}(o),new l(o)},l.prototype.click=function(t){var a=this.option.elem,l=this.option;i.on("tab("+this.option.elem+")",function(i){var n=e("#"+a+" .layui-tab-title .layui-this").attr("lay-id");if(sessionStorage.setItem(l.elem+"-pear-tab-data-current",n),!l.preload){var r=e(".layui-tab[lay-filter='"+a+"'] .layui-tab-content").find("iframe[id='"+n+"']"),c=r.attr("src");c&&"about:blank"!==c||(s.forEach(function(t,a){t.id===n&&(c=t.url)}),o(a),r.attr("src",c))}t(n)})},l.prototype.positionTab=function(){var t=e(".layui-tab[lay-filter="+this.option.elem+"]  .layui-tab-title"),a=0;t.children("li").each(function(){if(e(this).hasClass("layui-this"))return!1;a+=e(this).outerWidth()}),t.animate({scrollLeft:a-t.width()/3},200)},l.prototype.clear=function(){sessionStorage.removeItem(this.option.elem+"-pear-tab-data"),sessionStorage.removeItem(this.option.elem+"-pear-tab-data-current")},l.prototype.addTab=function(t){var a="";t.close?a+='<span class="pear-tab-active"></span><span class="able-close title">'+t.title+'</span><i class="layui-icon layui-unselect layui-tab-close">ဆ</i>':a+='<span class="pear-tab-active"></span><span class="disable-close title">'+t.title+'</span><i class="layui-icon layui-unselect layui-tab-close">ဆ</i>',i.tabAdd(this.option.elem,{title:a,content:'<iframe id="'+t.id+'" data-frameid="'+t.id+'" scrolling="auto" frameborder="0" src="'+t.url+'" style="width:100%;height:100%;" allowfullscreen="true"></>',id:t.id}),s.push(t),sessionStorage.setItem(this.option.elem+"-pear-tab-data",JSON.stringify(s)),sessionStorage.setItem(this.option.elem+"-pear-tab-data-current",t.id),i.tabChange(this.option.elem,t.id)};var r=0;function o(t,a){var i='<div id="pear-tab-loading'+r+'" class="pear-tab-loading"><div class="ball-loader"><span></span><span></span><span></span><span></span></div></div>',l=e(".layui-tab[lay-filter='"+t+"'] .layui-tab-content .layui-show").find("iframe");a&&(l=e(".layui-tab[lay-filter='"+t+"'] .layui-tab-content").find("iframe[id='"+a+"']")),l.parent().append(i);var s=e("#"+t).find("#pear-tab-loading"+r);s.css({display:"block"}),r++,l.on("load",function(){s.fadeOut(1e3,function(){s.remove()})})}function c(t,a,i,l){var r,o=e(".layui-tab[lay-filter='"+t+"']").find(".layui-tab-title").find("li[lay-id='"+a+"']"),c=o.next("li");if(!o.hasClass("layui-this"))return o.remove(),e(".layui-tab[lay-filter='"+t+"']").find("iframe[id='"+a+"']").parent().remove(),s=JSON.parse(sessionStorage.getItem(t+"-pear-tab-data")),n=sessionStorage.getItem(t+"-pear-tab-data-current"),s=s.filter(function(t){return t.id!=a}),sessionStorage.setItem(t+"-pear-tab-data",JSON.stringify(s)),!1;if(c.length)c.addClass("layui-this"),r=c.attr("lay-id"),e("#"+t+" [id='"+r+"']").parent().addClass("layui-show");else{var d=o.prev("li");d.addClass("layui-this"),r=d.attr("lay-id"),e("#"+t+" [id='"+r+"']").parent().addClass("layui-show")}i(r),s=JSON.parse(sessionStorage.getItem(t+"-pear-tab-data")),n=sessionStorage.getItem(t+"-pear-tab-data-current"),s=s.filter(function(t){return t.id!=a}),sessionStorage.setItem(t+"-pear-tab-data",JSON.stringify(s)),sessionStorage.setItem(t+"-pear-tab-data-current",r),o.remove(),e(".layui-tab[lay-filter='"+t+"']").find("iframe[id='"+a+"']").parent().remove()}function d(t,a){var i=e("#"+a.elem+"  .layui-tab-title"),l=i.scrollLeft();"left"===t?i.animate({scrollLeft:l-450},200):i.animate({scrollLeft:l+450},200)}l.prototype.changeTabTitleById=function(t,a,i){e(".layui-tab[lay-filter='"+t+"'] .layui-tab-title [lay-id='"+a+"'] .title").html(i)},l.prototype.delTabByElem=function(t,a,i){e(".layui-tab[lay-filter='"+t+"'] .layui-tab-title [lay-id='"+a+"']").find("span").is(".able-close")&&c(t,a,i)},l.prototype.delOtherTabByElem=function(t,a){var i=e(".layui-tab[lay-filter='"+t+"'] .layui-tab-title .layui-this").attr("lay-id"),l=e(".layui-tab[lay-filter='"+t+"'] .layui-tab-title li");e.each(l,function(l){e(this).attr("lay-id")!=i&&e(this).find("span").is(".able-close")&&c(t,e(this).attr("lay-id"),a)})},l.prototype.delAllTabByElem=function(t,a){e(".layui-tab[lay-filter='"+t+"'] .layui-tab-title .layui-this").attr("lay-id");var i=e(".layui-tab[lay-filter='"+t+"'] .layui-tab-title li");e.each(i,function(i){e(this).find("span").is(".able-close")&&c(t,e(this).attr("lay-id"),a)})},l.prototype.delCurrentTabByElem=function(t,a){var i=e(".layui-tab[lay-filter='"+t+"'] .layui-tab-title .layui-this");i.find("span").is(".able-close")&&c(t,i.attr("lay-id"),a)},l.prototype.addTabOnlyByElem=function(t,a,l){var n="";if(a.close?n+='<span class="pear-tab-active"></span><span class="able-close title">'+a.title+'</span><i class="layui-icon layui-unselect layui-tab-close">ဆ</i>':n+='<span class="pear-tab-active"></span><span class="disable-close title">'+a.title+'</span><i class="layui-icon layui-unselect layui-tab-close">ဆ</i>',e(".layui-tab[lay-filter='"+t+"'] .layui-tab-title li[lay-id]").length<=0)i.tabAdd(t,{title:n,content:'<iframe id="'+a.id+'" data-frameid="'+a.id+'" scrolling="auto" frameborder="0" src="'+a.url+'" style="width:100%;height:100%;" allowfullscreen="true"></iframe>',id:a.id}),0!=l&&0!=l&&o(t,a.id),s.push(a),sessionStorage.setItem(t+"-pear-tab-data",JSON.stringify(s));else{var r=!1;e.each(e(".layui-tab[lay-filter='"+t+"'] .layui-tab-title li[lay-id]"),function(){e(this).attr("lay-id")==a.id&&(r=!0)}),0==r&&(i.tabAdd(t,{title:n,content:'<iframe id="'+a.id+'" data-frameid="'+a.id+'" scrolling="auto" frameborder="0" src="'+a.url+'" style="width:100%;height:100%;" allowfullscreen="true"></iframe>',id:a.id}),0!=l&&0!=l&&o(t,a.id),s.push(a),sessionStorage.setItem(t+"-pear-tab-data",JSON.stringify(s)))}sessionStorage.setItem(t+"-pear-tab-data-current",a.id),i.tabChange(t,a.id)},l.prototype.addTabOnly=function(t,a){var l="";if(t.close?l+='<span class="pear-tab-active"></span><span class="able-close title">'+t.title+'</span><i class="layui-icon layui-unselect layui-tab-close">ဆ</i>':l+='<span class="pear-tab-active"></span><span class="disable-close title">'+t.title+'</span><i class="layui-icon layui-unselect layui-tab-close">ဆ</i>',e(".layui-tab[lay-filter='"+this.option.elem+"'] .layui-tab-title li[lay-id]").length<=0)i.tabAdd(this.option.elem,{title:l,content:'<iframe id="'+t.id+'" data-frameid="'+t.id+'" scrolling="auto" frameborder="0" src="'+t.url+'" style="width:100%;height:100%;" allowfullscreen="true"></iframe>',id:t.id}),0!=a&&0!=a&&o(this.option.elem,t.id),s.push(t),sessionStorage.setItem(this.option.elem+"-pear-tab-data",JSON.stringify(s)),sessionStorage.setItem(this.option.elem+"-pear-tab-data-current",t.id);else{var n=!1;if(e.each(e(".layui-tab[lay-filter='"+this.option.elem+"'] .layui-tab-title li[lay-id]"),function(){e(this).attr("lay-id")==t.id&&(n=!0)}),0==n){if(0!=this.option.tabMax&&e(".layui-tab[lay-filter='"+this.option.elem+"'] .layui-tab-title li[lay-id]").length>=this.option.tabMax)return layer.msg("最多打开"+this.option.tabMax+"个标签页",{icon:2,time:1e3,shift:6}),!1;i.tabAdd(this.option.elem,{title:l,content:'<iframe id="'+t.id+'" data-frameid="'+t.id+'" scrolling="auto" frameborder="0" src="'+t.url+'" style="width:100%;height:100%;" allowfullscreen="true"></iframe>',id:t.id}),0!=a&&0!=a&&o(this.option.elem,t.id),s.push(t),sessionStorage.setItem(this.option.elem+"-pear-tab-data",JSON.stringify(s)),sessionStorage.setItem(this.option.elem+"-pear-tab-data-current",t.id)}}i.tabChange(this.option.elem,t.id),sessionStorage.setItem(this.option.elem+"-pear-tab-data-current",t.id)},l.prototype.refresh=function(t){var a=e(".layui-tab[lay-filter='"+this.option.elem+"'] .layui-tab-content .layui-show").find("iframe");0!=t&&0!=t&&o(this.option.elem),a.attr("src",a.attr("src"))},t("tab",new l)});